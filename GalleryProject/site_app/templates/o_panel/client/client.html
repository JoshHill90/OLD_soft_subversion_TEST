{% extends 'panel.html' %}
{% block title %}O | Clients{% endblock %}
{% block content %}
{% load static %}
{% if user.is_authenticated %}

<div class='row'>
	<div class='col-12  order-md-2 col-md-6 mt-4 mb-4'>
		<h1 class='h1-1'>Client Options</h1>
		<hr>
		<div class='section-min'>
			<div class='row'>

				<div class='col-6 mt-4'>
					<a href="{% url 'invite' %}">
						<div class='section-pad addLoader text-center' >
						<i class="fa-solid fa-user-plus fa-2xl"></i>
						<p class='mt-2'>Client Intake</p>
						</div>
					</a>
				</div>
				
				<div class='col-6 mt-4'>
					<a href="{% url 'invite' %}">
							<div class='section-pad addLoader text-center' >
							<i class="fa-solid fa-user-gear fa-2xl"></i>
							<p class='mt-2'>Client settings</p>
						</div>
					</a>
				</div>
				
			</div>
		</div>
	</div>
	<div class='col-12 order-md-1 col-md-6 mt-4 mb-4'>
		
		<h1 class='h1-1 mb-2'>Client Search and Filter</h1>
		<hr>
		<div class='sections-med'>
			<form method="GET" action="." class='form-group'>
				<div class='row'>
					<div class='col-12 mb-2'>
						<input class="form-control" list="project-list" type="search" name="project" placeholder="Project">
						<datalist id="project-list">
						{% for project in project_list %}
							<option value="{{ project.name }}"></option>
						{% endfor %}
						</datalist>
					</div>
					<div class='col-12 mb-2'>
						<input class="form-control" list="client-list" type="search" name="client" placeholder="Client">
						<datalist id="client-list">
						{% for client in client_info %}
							<option value="{{ client.client_details.client }}"></option>
						{% endfor %}
						</datalist>
					</div>
				</div>
				<div class='row'>
					<div class="col-12 col-md-4 mt-4">
						<select class="form-select" type="select" name="order">
							<option value="Newest">Newest</option>
							<option value="Oldest">Oldest</option>
						</select>
					</div>                
					<div class="col-12 col-md-4 mt-4">
						<button type="submit" class="btn-cust btn-cust-color mt-4">Search</button>
					</div>
					<div class="col-12 col-md-4 mt-4">
						<button type="submit" onclick="{% url 'o-client' %}" class="btn-cust btn-cust-color mt-4">Clear</button>
					</div>
				</div>
			</form>
		</div>
	</div>

	<div class='col-12 order-md-3  mt-4'>
		<div class="overflow-auto section-scroll">
			<div class='section-dt' style='width:98%'>
				<div class='row'>
					<div class='col-12 text-center mt-4'>
						<div class='row'>
							<div class='col-6 col-md-3'>
								<p class="p-p">
									Client ID: 
								</p>
							</div>
							<div class='col-6 col-md-3'>
								<p class="p-p">
									Client Name: 
								</p>
							</div>
							<div class='col-6 col-md-3'>
								<p class="p-p">
									Projet Count: 
								</p>
							</div>
							<div class='col-6 col-md-3'>
								<p class="p-p">
									Clent Details: 
								</p>
							</div>

						</div>
					</div>
					<hr>
					{% for clients in client_list %}
					<div class='col-12  text-center mt-4'>
						<div class='row mt-1'>
							<div class='col-6 col-md-3'>
								<p class="p-p">
									{{ clients.id }}
								</p>
							</div>
							<div class='col-6 col-md-3'>
								<p class="p-p">
									{{ clients.name }} 
								</p>
							</div>
							<div class='col-6 col-md-3'>
								<p class="p-p">
									{% for project in project_list %}
										{% if project.client_id == clients %}
										{{ forloop.counter }}
										{% endif %}
									{% endfor %}
								</p>
							</div>

							<div class='col-6 col-md-3'>
								
								<button class="btn-icon" id="detailsBtn{{ forloop.counter }}" onclick="handleModal('detailsWindow{{ forloop.counter }}', 'detailsBtn{{ forloop.counter }}', 'closeDetails{{ forloop.counter }}')">
									Details
								</button>

							</div>
						</div>
						<hr>
					</div>
					{% endfor %}
				</div>
				
			</div>
			

			<div class='section-mb'>
				{% for clients in client_list %}
				<div class='col-12  text-center mt-4'>
					<div class='row mt-1'>
						<div class='col-6'>
							<p class="p-p">
								Client ID: {{ clients.id }}
							</p>
						</div>
						<div class='col-6'>
							<p class="p-p">
								Client Name: {{ clients.name }} 
							</p>
						</div>
						<div class='col-6'>
							<p class="p-p">
								{% for project in project_list %}
									{% if project.client_id == clients %}
									Projet Count: {{ forloop.counter }}
									{% endif %}
								{% endfor %}
							</p>
						</div>

						<div class='col-6'>
							
							<button class="btn-icon"id="detailsBtn2{{ forloop.counter }}" onclick="handleModal('detailsWindow{{ forloop.counter }}', 'detailsBtn2{{ forloop.counter }}', 'closeDetails{{ forloop.counter }}')">
								Details
							</button>
						</div>
					</div>
					<hr>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>

	{% for clients in client_list %}
	<div id="detailsWindow{{ forloop.counter }}" class="details-modal">

		<!-- Modal content -->
		<div class="details-content overflow-auto">
			<span class="closeDetails" id="closeDetails{{ forloop.counter }}"><i class="fa-solid fa-circle-xmark fa-lg icon-color"></i></span>
			<div class='row'>
				<div class='col-12 col-md-9'>
					<h1 class='h1-1'>
						Client Details 
					</h1>
					<hr>

				</div>
			</div>
			<div class='row mt-4 mb-4'>
				<div class='col-12 col-md-6'>
					<h1 class='h1-1'>
						Client Information
					</h1>
					<hr>

					<div class='section-small'>
						<div class='row mt-4 mb-4'>
							<div class='col-12'>
								<p class="p-p">
									Name: {{clients.user_id.first_name }} {{clients.user_id.last_name }}
								</p>
							</div>
							<div class='col-12'>
								<p class="p-p">
									Address: <br> {{clients.address_1 }} <br> {{clients.address_2 }} <br> {{clients.city }}, {{clients.state }} {{clients.zip_code }}
								</p>
							</div>		
							<div class='col-12'>
								<p class="p-p">
									Contact: <br> {{clients.email }} <br> {{clients.phone }}
								</p>
							</div>	
						</div>

						<form method="post" action="{% url 'o-client' %}">
							{% csrf_token %}
							<input type="hidden" name="object_id" value="{{ clients.id }}">
							<button class='btn-cust text-center mt-4 mb-4'  type="submit" name="delete" value="Delete">
								<i class="fa-solid fa-user-slash fa-2xl"></i>
								<p class='mt-2'>Delete User</p>
							</button>
						</form>
					</div>	
				</div>

				<div class='col-12 col-md-3'>
					<h1 class='h1-1'>
						Client Projects
					</h1>
					<hr>

					<div class='section-small'>
						{% for project in project_list %}
						{% if project.client_id == clients %}
						<a href="{% url 'o-project-details' project.slug %}">
							{{ project }}
							</a>
						{% endif %}
						{% endfor %}
					</div>	
				</div>
				<div class='col-12 col-md-3'>
					<h1 class='h1-1'>
						Project Request
					</h1>
					<hr>

					<div class='section-small'>
						{% for project in project_request %}
						{% if project.client_id == clients and project.status == 'pending' %}
						<a href="{% url 'request-details' project.slug %}">
						{{ project }}
						</a>
						{% endif %}
						{% endfor %}
					</div>	
				</div>
			</div>
		</div>
	</div>
	{% endfor %}
</div>

<script src={% static 'js/graphs.js' %}></script>
<script>
	function initializeModals() {
		document.addEventListener("DOMContentLoaded", function() {
		  {%  for clients in client_list %}
			handleModal("detailsWindow{{ forloop.counter }}", "detailsBtn{{ forloop.counter }}", "closeDetails{{ forloop.counter }}");
			handleModal("detailsWindow{{ forloop.counter }}", "detailsBtn2{{ forloop.counter }}", "closeDetails{{ forloop.counter }}");
		  {% endfor %}
		});
	  };
	initializeModals();
</script>

  

{% endif %}


{% endblock %}